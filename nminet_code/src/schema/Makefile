TOP=../..

include $(TOP)/Makefile.inc

XSD_DIR=$(TOP)/../service/schema

# enumerate all xsds
#XSDS=$(foreach dir, $(XSD_DIR), $(wildcard $(dir)/*.xsd))
XSDS=$(XSD_DIR)/PlatformNetworkModel.xsd
# make list of generated python file names without directory part
PY_GENS=$(foreach xsd, $(XSDS), $(addsuffix _gen.py, $(basename $(notdir $(xsd)))))


all: $(PY_GENS) _list.py


%_gen.py:: $(XSD_DIR)/%.xsd
	-$(GENERATE_DS) --no-dates --no-versions --silence -f -o $(subst .,_,$(basename $(@))).py $(<)

_list.py: $(PY_GENS)
	@echo "Generating $(@)..."
	@echo "# Do not edit, this file is generated by Makefile" > $(@)
	@echo "schemas = [" >> $(@)
	@for m in $(PY_GENS); do echo "    \"$${m%%_gen.py}\","; done  >> $(@)
	@echo "]" >> $(@)

clean:
	rm -f *.pyc *.pyo

distclean realclean: clean
	rm -f $(PY_GENS) _list.py

.PHONY: all clean distclean realclean
